<!DOCTYPE html>
<html>
  <head>
      <title>Welcome</title>
      <meta name="save_as" content="index.html"></meta>
      <meta name="date" content="2019-08-29 09:00"></meta>
  </head>
  <body>
    <script src="{static}/scripts/data.js" type="text/javascript"></script>
    <script src="{static}/scripts/getFullDataPath.js" type="text/javascript"></script>
    <script src="https://cdn.rawgit.com/larsgw/citation.js/archive/citation.js/citation-0.4.0-9.js" type="text/javascript"></script>
    <script type="text/javascript" async
      src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async>
    </script>
    <script>
      function update_file(filename) {
        file=filename+'.dat'
        lnk_file.setAttribute('href',getFullDataPath(file));
        lnk_file=document.getElementById('lnk_file');
        data.load(file,onApplyData);
      }
      function onApplyData(dat) {
        const Cite = require('citation-js');
        const LatexInline=['\\(','\\)']
        par=document.getElementById("data_par")
        par.innerHTML='';
        var md=[];
        var els=[];
        md.push(["Title",dat.title]);
        md.push(["Code",dat.code]);
        md.push(["Basis",dat.basis]);
        md.push(["DOI",dat.doi]);
        md.forEach(function(element){
          var node = document.createElement("div");
          node.innerText= element[0]+': '+element[1];
          par.appendChild(node);
        });
        var node = document.createElement("h");
        node.innerText= "Excitations";
        par.appendChild(node);
        dat.excitations.forEach(function(el) {
          var node = document.createElement("div");
          node.innerHTML= String.raw`${LatexInline[0]} ${el.start.toLaTeX()} \rightarrow ${el.end.toLaTeX()}${LatexInline[1]}, ${LatexInline[0]}${el.Eabs}\:\mathrm{eV}${LatexInline[1]}`;
          MathJax.Hub.Queue(["Typeset",MathJax.Hub,node]);
          par.appendChild(node);
          
        });
        let publi = new Cite(dat.doi.string)
        var lnkdoi = document.createElement("a");
        let output = publi.format('bibliography', {
         format: 'html',
         template: 'apa',
         lang: 'en-US'
          })
        lnkdoi.innerHTML=output
        lnkdoi.setAttribute('target','_blank');
        lnkdoi.setAttribute('href',dat.doi.url);
        par.appendChild(lnkdoi);
      }
    </script>
    <script>
      window.onload=function() {
        console.info("Loaded")
        var inp = document.getElementById("inp_filename");
        inp.addEventListener("keydown", function (e) {
          if (e.keyCode === 13) {  //checks whether the pressed key is "Enter"
            update_file(inp.value);
          }
        }
        );
      }
    </script>

    <label>Write a data file name without extension<br/>
      <input type="text" id='inp_filename'></input>
    </label><br/>
    <p id=data_par></p>
    <a target="_blank" id='lnk_file' type='text/plain'>Go to file</a>
  </body>
</html>
