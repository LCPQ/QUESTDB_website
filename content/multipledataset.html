---
title: "Multiple dataset"
date: 2019-09-27 16:41
draft: false
---
<script src="/scripts/data.js" type="text/javascript"></script>
<script src="/scripts/loadAllData.js" type="text/javascript"></script>
<script src="/scripts/getFullDataPath.js" type="text/javascript"></script>
<script src="/scripts/getTextFromFile.js" type="text/javascript"></script>
<script src="/scripts/trueTypeOf.js" type="text/javascript"></script>
<script src="/scripts/uniq.js"></script>
<script src="/scripts/noNan.js"></script>
<script src="/scripts/websiteFile.js"></script>
<script src="https://cdn.rawgit.com/larsgw/citation.js/archive/citation.js/citation-0.4.0-9.js"
  type="text/javascript"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://unpkg.com/simple-statistics@7.0.2/dist/simple-statistics.min.js"></script>
<script>
  window.onload= async ()=>{
    window.Cite = require('citation-js');
    $('#form_dat input[type=radio]').on('change', async function(event) {
      var result = $(this).val();
      var proms=[];
      switch (result) {
        case "abs":

          proms=getAbsFilesName().map((f) => AbsDataFile.loadAsync(f));
          break;
        case "fluo":
          proms=getFluoFilesName().map((f) => FluoDataFile.loadAsync(f));
          break;
        case "zpe":
          proms=getZPEFilesName().map((f) => ZPEDataFile.loadAsync(f));
          break;
      }
      window.dats=await Promise.all(proms)
      reloadFileSelector()
      await reloadSelect()
    })
  }
  function reloadFileSelector(){
    document.getElementById("customFiles_input").value = ""
  }

  async function reloadSelect(){
    radioval=$('#form_dat > input[name=datatype]:checked').val();
    for(file of Array.from(document.getElementById("customFiles_input").files))
    {
      switch (radioval) {
        case "abs":
          var dat=await AbsDataFile.loadAsync(file)
          window.dats.push(dat)
          break;
      
        case "fluo":
          dat=await FluoDataFile.loadAsync(file)
          window.dats.push(dat)
          break;
        case "ZPE":
          dat=await ZPEDataFile.loadAsync(file)
          window.dats.push(dat)
          break;
      }
    }
    $('#form_dat > select').each(function(){
      $(this).find('option[value!=""]').remove()
      const vals=uniq(window.dats.map((d)=>{return d[$(this).attr("name")]}))
      for (const val of vals){
        op=document.createElement("option")
        op.value=JSON.stringify(val)
        op.innerText=val.toString()
        $(this).append(op)
    }
    })
    await reloadContent()
  }
  async function reloadStat(){
    var stb=document.getElementById("stat_table_b");
    stb.innerHTML=''
    const sel_ref=document.getElementById("sel_ref")
    const refstr=((sel_ref.selectedIndex>=0) ? sel_ref.options[sel_ref.selectedIndex].value : null)
    var sdatdic=new Map()
    for (const d of window.filt) {
      const key=JSON.stringify([d.code,d.method,d.DOI])
      if(!(sdatdic.has(key)))
      {
        sdatdic.set(key,new Map())
      }
      for(const exc of d.excitations){
        const key2=JSON.stringify([d.molecule,exc.initial,exc.final])
        const keydic=sdatdic.get(key)
        if(!(keydic.has(key2))){
          keydic.set(key2,[])
        }
        keydic.get(key2).push(exc.value)
      } 
    }
    var sdic= new Map()
    for(const [key,sdat] of sdatdic){
      for(const [key2,exval] of sdat){
        if(!(sdic.has(key))){
          sdic.set(key,[])
        }
        sdic.get(key).push(exval-((sdatdic.has(refstr)) ? sdatdic.get(refstr).get(key2) : NaN))
      }
    }
    for(const[keystr,vals] of sdic){
      row=document.createElement("tr")
      key=JSON.parse(keystr)
      Reflect.setPrototypeOf(key[0], code.prototype)
      Reflect.setPrototypeOf(key[1], method.prototype)
      Reflect.setPrototypeOf(key[2], doi.prototype)
      for(const el of key){
        var td=document.createElement("td")
        if(trueTypeOf(el)=="doi"){
          var publipromise=window.Cite.async(el.string)
          var lnkdoi=document.createElement("a")
          lnkdoi.href=el.url
          lnkdoi.target="_blank"
          publi=await publipromise
          lnkdoi.innerHTML=publi.format('citation', {
                format: 'html',
                lang: 'en-US'
          })
          td.appendChild(lnkdoi)
        }
        else{
          td.innerText=el
        }
        row.appendChild(td)
      }
      const noNanVals=vals.filter((v)=>!Number.isNaN(v))
      const avals=noNanVals.map(v=>Math.abs(v))
      for(const val of [ss.min(noNanVals),ss.max(noNanVals),ss.mean(noNanVals),ss.mean(avals),ss.median(noNanVals),ss.median(avals),ss.rootMeanSquare(noNanVals),ss.variance(noNanVals),ss.standardDeviation(noNanVals)]){
        var td=document.createElement("td")
        td.innerText=noNanPrecision(val,3)
        row.appendChild(td)
      }
      stb.appendChild(row)
    }
  }
  async function reloadContent(){
    const LatexInline=['\\(','\\)']
    window.filt=window.dats
    $('#form_dat > select').each(function(){
      const prop=$(this).attr("name")
      const values=$(this).val()
      window.filt=window.filt.filter((d)=>{
        if(typeof values=="undefined" || values==null){
         return false 
        }
        return values.includes(JSON.stringify(d[prop]))
      })
    })
    var dtb=document.getElementById("dat_table_b");
    dtb.innerHTML=''
    sel_ref=document.getElementById("sel_ref")
    for (const d of window.filt) {
      var row=document.createElement("tr")
      var rowd=[]
      var els=[d.molecule,d.comment,d.code,d.method,d.DOI]
      var op=document.createElement("option")
      var opObjVal=els.slice(2)
      op.value=JSON.stringify(opObjVal)
      op.innerText=opObjVal.join(" ")
      sel_ref.appendChild(op)
      for(const el of els){
        td=document.createElement("td")
        if(trueTypeOf(el)=="doi"){
          var publipromise=window.Cite.async(el.string)
          var lnkdoi=document.createElement("a")
          lnkdoi.href=el.url
          lnkdoi.target="_blank"
          publi=await publipromise
          lnkdoi.innerHTML=publi.format('citation', {
                format: 'html',
                lang: 'en-US'
              })
          td.appendChild(lnkdoi)
        }
        else{
          td.innerText=el
        }
        row.appendChild(td)
      }
      var lnkfile=document.createElement("a")
      lnkfile.target="_blank"
      lnkfile.innerText="Go to file"
      lnkfile.href=await d.sourceFile.getViewerURL()
      row.appendChild(lnkfile)
      dtb.appendChild(row)
    }
    await reloadStat()
  }
</script>
{{< getDataFilesName >}}
  <p>
    In this page you can compare multiple dataset and have somme statistics to evaluate method or basis accuracy.
    For this follow this steps
    <ol>
      <li>Select a value type (Absorbtion, fluorescence or \(\Delta \text{ZPE}\))</li>
      <li>You can add custom files if you want</li>
      <li>Choose each parameters (Of course you can select multiples values for each)</li>
        <ul>
          <li>Molecule</li>
          <li>Code</li>
          <li>Method</li>
          <li>Paper</li>
        </ul>
      <li>Select a reference from already selected data (by default the first is already selected)</li>
      <li>Now you can see the list of selected data and some statistics about these data</li>
    </ol>
  </p>
  <form id="form_dat" action="" method="post">
    <legend>Data type</legend>
    <input type="radio" id="abs" value="abs" name="datatype">
    <label for="abs">Absorption</label>
    <input type="radio" id="fluo" value="fluo" name="datatype">
    <label for="fluo">Fluorescence</label>
    <input type="radio" id="zpe" value="zpe" name="datatype">
    <label for="zpe">\(\Delta \text{ZPE}\)</label>
    <br/>
    <label for="customFiles">Add custom data file</label>
    <input type="file" multiple onchange="reloadSelect()" id="customFiles_input"></input>
    <br/>
    <label for="mol_select">Molecule</label>
    <select multiple id="mol_select" onchange="reloadContent()" name="molecule"></select>
    <label for="code_select">Code</label>
    <select multiple id="code_select" onchange="reloadContent()" name="code"></select>
    <label for="method_select">Method</label>
    <select multiple id="method_select" onchange="reloadContent()" name="method"></select>
    <label for="DOI_select">Paper</label>
    <select multiple id="DOI_select" onchange="reloadContent()" name="DOI"></select>
  </form>
  <form id="form_ref">
    <label for="sel_ref">Reference</label>
    <select id="sel_ref" onchange="reloadStat()">
    </select>
  </form>
  <br/>
<div id="data_div">
  <table id="dat_table">
    <thead>
      <th>Molecule</th>
      <th>Comment</th>
      <th>Code</th>
      <th>Method</th>
      <th>Paper</th>
      <th>File</th>
    </thead>
    <tbody id="dat_table_b">
    </tbody>
  </table>
</div>
<div id="stat_div">
  <table id="stat_table">
    <thead>
      <th>Code</th>
      <th>Method</th>
      <th>Paper</th>
      <th>Min</th>
      <th>Max</th>
      <th>Mean</th>
      <th>Absolute Mean</th>
      <th>Median</th>
      <th>Absolute Median</th>
      <th>RMS</th>
      <th>Variance</th>
      <th>Standard deviation</th>
    </thead>
    <tbody id="stat_table_b">
    </tbody>
  </table>
</div>